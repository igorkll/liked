local a=table.insert;local b=string.gsub;local c=string.sub;local error=error;local d=string.find;local e=table.remove;local f={}function f.parseargs(g)local h={}b(g,"([%-%w]+)=([\"'])(.-)%2",function(i,j,k)h[i]=k end)return h end;function f.collect(g)local l={}local m={}a(l,m)local n,o,p,q,r;local s,t=1,1;while true do n,t,o,p,q,r=d(g,"<(%/?)([%w:]+)(.-)(%/?)>",s)if not n then break end;local u=c(g,s,n-1)if not d(u,"^%s*$")then a(m,u)end;if r=="/"then a(m,{label=p,xarg=f.parseargs(q),empty=1})elseif o==""then m={label=p,xarg=f.parseargs(q)}a(l,m)else local v=e(l)m=l[#l]if#l<1 then error("nothing to close with "..p)end;if v.label~=p then error("trying to close "..v.label.." with "..p)end;a(m,v)end;s=t+1 end;local u=c(g,s)if not d(u,"^%s*$")then a(l[#l],u)end;if#l>1 then error("unclosed "..l[#l].label)end;return l[1]end;return f