local computer,component=computer,component;modem=component.proxy(component.list("modem")()or"")tunnel=component.proxy(component.list("tunnel")()or"")local a=38710;local b="rc_wake"if modem then pcall(modem.setStrength,math.huge)modem.close()modem.open(a)end;drone=component.proxy(component.list("drone")()or"")robot=component.proxy(component.list("robot")()or"")local c;local d=component.proxy(component.list("gpu")()or"")local e=component.proxy(component.list("eeprom")()or"")local f=component.list("screen")()if d and f then d.bind(f)d.setResolution(10,2)else d=nil end;if drone then c=drone.name()elseif robot then c=robot.name()end;function setWake(g)if g then if tunnel then tunnel.setWakeMessage(b)end;if modem then modem.setWakeMessage(b)end else if tunnel then tunnel.setWakeMessage()end;if modem then modem.setWakeMessage()end end end;function setColor(h)local i=drone or robot;if i then i.setLightColor(h)end end;currentColor=0xffffff;setColor(currentColor)function setText(j)if drone then drone.setStatusText(j)return 1 elseif d then local k,l=d.getResolution()d.setBackground(0)d.setForeground(0xffffff)d.fill(1,1,k,l," ")local m=1;local n=1;for o=1,#j do local p=j:sub(o,o)if p=="\n"then m=m+1;n=1 else d.set(n,m,p)n=n+1 end end;return 1 end end;local q=setText("")local r;do local s=computer.getDeviceInfo()local function t(u)return component.list(u)()and u end;local function v()local i=s[computer.address()]if i and i.description and i.description:lower()=="server"then return"server"end end;r=t("tablet")or t("microcontroller")or t("drone")or t("robot")or v()or t("computer")or"unknown"end;local w;local x=e.getData()if#x==0 then x=nil end;local function y()if q then if x then setText("password\nchanged")else w=""for o=1,8 do w=w..string.char(math.random(33,126))end;setText("password:\n"..w)end end end;y()local function z(A)local B={}for o=1,16 do B[o]=(8*o*#A+#A)%256 end;for o=0,#A-1 do local C=A:byte((o-1)%#A+1)local D=A:byte(o+1)local E=A:byte((o+1)%#A+1)local n=(o+C+E)%16+1;B[n]=((B[n]+D+13)*3*E+E*C+(o+1)*6)%256 end;local F=""for o=1,#B do F=F..string.char(B[o])end;return F end;local function G(H)if w then return H==w elseif x then return z(H)==x else return true end end;local function I(J,K,...)if J then tunnel.send("rc_tunnel",...)else modem.send(K,a,...)end end;if tunnel then tunnel.send("rc_adv",r,c)end;local L=-math.huge;local M;local J;while true do local N={computer.pullSignal(0.5)}if M then if N[1]=="modem_message"and N[3]==M then local O,P=N[6],N[7]if O=="rc_exec"then local Q,R=load(P)if Q then I(J,M,pcall(Q,table.unpack(N,8)))else I(J,M,false,R)end elseif O=="rc_color"then currentColor=P;setColor(currentColor)elseif O=="rc_title"then setText(P)elseif O=="rc_out"then currentColor=0xffffff;setColor(currentColor)y()computer.beep(200,0.2)computer.beep(150,0.2)computer.beep(100,0.8)I(J,M,true)M=nil end end else if N[1]=="modem_message"then local S=N[3]J=tunnel and N[2]==tunnel.address;if N[6]=="rc_radv"then if modem then modem.send(S,a,"rc_adv",r,c)end;if tunnel then tunnel.send("rc_adv",r,c)end elseif N[6]=="rc_connect"and(w or x or N[5]<=8)then if G(N[7])then setColor(0x00ff00)computer.beep(1800,0.05)computer.beep(1800,0.05)setColor(currentColor)I(J,S,true)M=S;setText("")else setColor(0xff0000)computer.beep(100,0.1)computer.beep(100,0.1)setColor(currentColor)I(J,S,false)end end end;if modem then local T=computer.uptime()if T-L>3 then if not w and not x then pcall(modem.setStrength,8)end;modem.broadcast(a,"rc_adv",r,c)pcall(modem.setStrength,math.huge)L=T end end end end