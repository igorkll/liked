local computer,component=computer,component;modem=component.proxy(component.list("modem")()or"")tunnel=component.proxy(component.list("tunnel")()or"")local a=38710;local b="rc_wake"if modem then pcall(modem.setStrength,math.huge)modem.close()modem.open(a)end;drone=component.proxy(component.list("drone")()or"")robot=component.proxy(component.list("robot")()or"")local c;local d=component.proxy(component.list("gpu")()or"")local e=component.proxy(component.list("eeprom")()or"")local f=component.list("screen")()if d and f then d.bind(f)d.setResolution(10,2)else d=nil end;if drone then c=drone.name()elseif robot then c=robot.name()end;function setWake(g)if g then if tunnel then tunnel.setWakeMessage(b)end;if modem then modem.setWakeMessage(b)end else if tunnel then tunnel.setWakeMessage()end;if modem then modem.setWakeMessage()end end end;function setColor(h)local i=drone or robot;if i then i.setLightColor(h)end end;currentColor=0xffffff;setColor(currentColor)function setText(j)if drone then drone.setStatusText(j)return 1 elseif d then local k,l=d.getResolution()d.setBackground(0)d.setForeground(0xffffff)d.fill(1,1,k,l," ")local m=1;local n=1;for o=1,#j do local p=j:sub(o,o)if p=="\n"then m=m+1;n=1 else d.set(n,m,p)n=n+1 end end;return 1 end end;local q=setText("")local r;do local s=computer.getDeviceInfo()local function t(u)return component.list(u)()and u end;local function v()local i=s[computer.address()]if i and i.description and i.description:lower()=="server"then return"server"end end;r=t("tablet")or t("microcontroller")or t("drone")or t("robot")or v()or t("computer")or"unknown"end;local w;passwordHash=e.getData()if#passwordHash==0 then passwordHash=nil end;local function x()if q then if passwordHash then setText("password\nchanged")else w=""for o=1,8 do w=w..string.char(math.random(33,126))end;setText("password:\n"..w)end end end;x()local function y(z)local A={}for o=1,16 do A[o]=(8*o*#z+#z)%256 end;for o=0,#z-1 do local B=z:byte((o-1)%#z+1)local C=z:byte(o+1)local D=z:byte((o+1)%#z+1)local n=(o+B+D)%16+1;A[n]=((A[n]+C+13)*3*D+D*B+(o+1)*6)%256 end;local E=""for o=1,#A do E=E..string.char(A[o])end;return E end;local function F(G)if passwordHash then return y(G)==passwordHash elseif w then return G==w else return true end end;local function H(I,J,...)if I then tunnel.send("rc_tunnel",...)else modem.send(J,a,...)end end;if tunnel then tunnel.send("rc_adv",r,c)end;local K=-math.huge;local L;local I;while true do local M={computer.pullSignal(0.5)}if L then if M[1]=="modem_message"and M[3]==L then local N,O=M[6],M[7]if N=="rc_exec"then local P,Q=load(O)if P then H(I,L,pcall(P,table.unpack(M,8)))else H(I,L,false,Q)end elseif N=="rc_color"then currentColor=O;setColor(currentColor)elseif N=="rc_title"then setText(O)elseif N=="rc_out"then currentColor=0xffffff;setColor(currentColor)x()computer.beep(200,0.2)computer.beep(150,0.2)computer.beep(100,0.8)H(I,L,true)L=nil end end else if M[1]=="modem_message"then local R=M[3]I=tunnel and M[2]==tunnel.address;if M[6]=="rc_radv"then if modem then modem.send(R,a,"rc_adv",r,c)end;if tunnel then tunnel.send("rc_adv",r,c)end elseif M[6]=="rc_connect"and(w or passwordHash or M[5]<=8)then if F(M[7])then setColor(0x00ff00)computer.beep(1800,0.05)computer.beep(1800,0.05)setColor(currentColor)H(I,R,true)L=R;setText("")else setColor(0xff0000)computer.beep(100,0.1)computer.beep(100,0.1)setColor(currentColor)H(I,R,false)end end end;if modem then local S=computer.uptime()if S-K>3 then if not w and not passwordHash then pcall(modem.setStrength,8)end;modem.broadcast(a,"rc_adv",r,c)pcall(modem.setStrength,math.huge)K=S end end end end